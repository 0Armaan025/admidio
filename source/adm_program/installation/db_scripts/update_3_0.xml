<?xml version="1.0" encoding="UTF-8"?>
<update>
	<step id="10">DELETE FROM %PREFIX%_preferences WHERE prf_name IN ('db_version', 'db_version_beta')</step>
	<step id="20">ALTER TABLE %PREFIX%_members ADD COLUMN mem_approved integer unsigned default null</step>
	<step id="30">ALTER TABLE %PREFIX%_members ADD COLUMN mem_comment varchar(255)</step>
	<step id="40">ALTER TABLE %PREFIX%_members ADD COLUMN mem_count_guests integer unsigned not null default '0'</step>
	<step id="50">UPDATE %PREFIX%_preferences SET prf_value = '25' WHERE prf_name LIKE 'lists_members_per_page'</step>
	<step id="60">CREATE TABLE IF NOT EXISTS %PREFIX%_messages 
        (msg_type varchar(10) NOT NULL, 
         msg_id1 bigint(20) NOT NULL, 
         msg_id2 int(10) NOT NULL, 
         msg_subject varchar(256) NOT NULL, 
         msg_usrid1 int(10) NOT NULL, 
         msg_usrid2 int(10) DEFAULT NULL, 
         msg_message text NOT NULL,
         msg_timestamp timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, 
         msg_read tinyint(1) NOT NULL DEFAULT '0') 
         ENGINE=InnoDB default character set = utf8 COLLATE=utf8_unicode_ci;</step>
    <step id="70">UPDATE %PREFIX%_preferences SET prf_value = '0' WHERE prf_name LIKE 'enable_pm_module'</step>
	<step id="80">DELETE FROM %PREFIX%_preferences WHERE prf_name IN ('enable_forum_interface', 'forum_version', 'forum_export_user', 'forum_praefix', 'forum_sqldata_from_admidio', 'forum_db', 'forum_srv', 'forum_usr', 'forum_pw', 'forum_set_admin', 'forum_link_intern', 'forum_width')</step>
	<step id="90">DELETE FROM %PREFIX%_preferences WHERE prf_name IN ('dates_show_calendar_select')</step>
	<step id="100">UPDATE %PREFIX%_preferences pr1 INNER JOIN %PREFIX%_preferences pr2 ON pr2.prf_name LIKE 'system_show_all_users' SET pr1.prf_value = pr2.prf_value WHERE pr1.prf_name LIKE 'user_management_show_all_users'</step>
	<step id="110">DELETE FROM %PREFIX%_preferences WHERE prf_name IN ('system_show_all_users')</step>
	<step id="120" database="mysql">ALTER TABLE %PREFIX%_preferences MODIFY COLUMN prf_name varchar(50) NOT NULL</step>
	<step id="130" database="postgresql">ALTER TABLE %PREFIX%_preferences ALTER COLUMN prf_name TYPE varchar(50)</step>
	<step id="140">UPDATE %PREFIX%_preferences SET prf_name = 'user_management_members_per_page' WHERE prf_name LIKE 'user_management_members_per_pa'</step>
	<step id="150">UPDATE %PREFIX%_preferences SET prf_name = 'user_management_days_field_history' WHERE prf_name LIKE 'user_management_days_field_his'</step>
	<step id="160">INSERT INTO %PREFIX%_components (com_type, com_name, com_name_intern, com_version, com_beta)
                         VALUES ('MODULE', 'ANN_ANNOUNCEMENTS', 'ANNOUCEMENTS', '3.0.0', 0)
                              , ('MODULE', 'BAC_DATABASE_BACKUP', 'BACKUP', '3.0.0', 0)
                              , ('MODULE', 'SYS_CATEGORIES', 'CATEGORIES', '3.0.0', 0)
                              , ('MODULE', 'DAT_DATES', 'DATES', '3.0.0', 0)
                              , ('MODULE', 'DOW_DOWNLOADS', 'DOWNLOADS', '3.0.0', 0)
                              , ('MODULE', 'GBO_GUESTBOOK', 'GUESTBOOK', '3.0.0', 0)
                              , ('MODULE', 'LNK_WEBLINKS', 'LINKS', '3.0.0', 0)
                              , ('MODULE', 'LST_LISTS', 'LISTS', '3.0.0', 0)
                              , ('MODULE', 'MEM_USER_MANAGEMENT', 'MEMBERS', '3.0.0', 0)
                              , ('MODULE', 'SYS_MESSAGES', 'MESSAGES', '3.0.0', 0)
                              , ('MODULE', 'PHO_PHOTOS', 'PHOTOS', '3.0.0', 0)
                              , ('MODULE', 'SYS_SETTINGS', 'PREFERENCES', '3.0.0', 0)
                              , ('MODULE', 'PRO_PROFILE', 'PROFILE', '3.0.0', 0)
                              , ('MODULE', 'SYS_REGISTRATION', 'REGISTRATION', '3.0.0', 0)
                              , ('MODULE', 'ROL_ROLE_ADMINISTRATION', 'ROLES', '3.0.0', 0)
                              , ('MODULE', 'ROO_ROOM_MANAGEMENT', 'ROOMS', '3.0.0', 0)</step>
	<step id="170" database="mysql">ALTER TABLE %PREFIX%_roles MODIFY COLUMN rol_name varchar(100) NOT NULL</step>
	<step id="180" database="postgresql">ALTER TABLE %PREFIX%_roles ALTER COLUMN rol_name TYPE varchar(100)</step>
	<step id="190" database="mysql">ALTER TABLE %PREFIX%_roles MODIFY COLUMN rol_location varchar(100)</step>
	<step id="200" database="postgresql">ALTER TABLE %PREFIX%_roles ALTER COLUMN rol_location TYPE varchar(100)</step>
	<step id="210">UPDATE %PREFIX%_preferences pr1 INNER JOIN %PREFIX%_preferences pr2 ON pr2.prf_name LIKE 'photo_thumbs_column' INNER JOIN %PREFIX%_preferences pr3 ON pr3.prf_name LIKE 'photo_thumbs_row' SET pr1.prf_value = pr2.prf_value * pr3.prf_value WHERE pr1.prf_name LIKE 'photo_thumbs_page'</step>
	<step id="220">DELETE FROM %PREFIX%_preferences WHERE prf_name IN ('photo_thumbs_column', 'photo_thumbs_row')</step>
	<step>stop</step>
</update>